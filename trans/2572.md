# 均值栈中的 CORS

> 原文:[https://www.javatpoint.com/cors-in-mean-stack](https://www.javatpoint.com/cors-in-mean-stack)

在前一节中，我们学习了如何使用 angular http 客户端。我们从 app.js 文件中获取帖子，并将它们显示在 localhost 3000/API/post 路径上。之前，我们遇到了 **CORS** 错误。本节将让我们了解它是什么，以及我们如何从应用程序中删除它。

**CORS** 代表**跨产地资源共享**。这正是我们正在做的。我们将运行在不同域上的服务器和客户端分开。我们对服务器使用了 localhost: 3000，对 angular app 使用了 localhost 4200。客户机和服务器都想相互交谈，但它们不在同一台主机上。如果他们在同一台主机上，他们可以毫无问题地进行通信。所以，如果请求来自不同的地址，这就给了我们一个所谓的 CORS 错误。

在许多现代网络应用中，我们需要允许这一点。这不是一个安全问题；这是被通缉的行为。为此，我们需要为所有可能的客户端公开我们的服务器 API，这是通过在服务器端响应上设置正确的头来实现的。我们将使用以下步骤来设置标题:

1)我们将回到我们的 app.js 文件，在这个文件中，我们将添加另一个中间件。该中间件将以下列方式在处理响应之前运行:

```

app.use((req, res, next)=>{
    next();
});

```

![CORS in MEAN Stack](../Images/5bf61f799b6f75a2c40d5c96c327b874.png)

最后使用 next()函数，因为请求应该能够继续到下一个中间件。

2)在调用 next()之前，我们需要精确地处理请求或响应。我们将采用响应对象，并使用 **setHeader()** 方法设置头。方法将头键作为第一个参数，头的值作为第二个参数。我们将设置标题名称**访问控制允许来源**。我们必须确保名称应该与其相同，因为这是浏览器能够理解的明确定义的标题。我们将通过以下方式将其值设置为星号(*):

```

res.setHeader("Access-Control-Allow-Origin", "*");

```

这个星形值意味着无论发送请求的应用程序在哪个域上运行。它被允许访问我们的资源。

![CORS in MEAN Stack](../Images/517b4ce88b014c3e1fccf6b988c6c7c4.png)

3)我们还需要另一个标题名**访问控制允许标题**。第一个头允许哪些域能够访问我们的资源，但是现在我们将其限制为发送请求的域，除了默认头之外，还有一组特定的头，例如浏览器。我们需要允许一些额外的标题，如来源标题，X-请求-带有标题，内容类型标题和接受标题，如下所示:

```

  res.setHeader(
    "Access-Control-Allow-Headers",
    "Origin, X-Requested-With, Content-Type, Accept");

```

![CORS in MEAN Stack](../Images/b0d41cd18a08b43379d6f27bebd9214f.png)

如果它有另一个上面没有定义的非默认头，访问将被阻止，即使我们通常允许它用于所有域。

4)我们再增加一个标题**访问控制允许方法**。在这个头中，我们将控制哪些 http 动词可以用来发送请求。我们希望允许**获取、发布、修补、删除**和**选项**。**选项**是默认情况下浏览器在发布请求之前发送的隐式请求。因此，即使从不从我们的 angular app 内直接发送这样的选项请求，它也会被隐式发送，因此我们应该允许它作为 http 动词。

```

res.setHeader("Access-Control-Allow-Methods",
    "GET, POST, PATCH, DELETE, OPTIONS");

```

![CORS in MEAN Stack](../Images/d62d2855f31d364892ca73aed1fccc31.png)

有了这些头，我们就可以发送那个请求了。我们将保存它，并将能够在我们的 angular 应用程序中看到服务器端的数据。

![CORS in MEAN Stack](../Images/f659cdc6787ccb2307a9b89af363a7f5.png)

* * *